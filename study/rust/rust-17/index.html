<!DOCTYPE html>
<html lang="kr-ko">
    <head>
        <meta name="description" content="Object-Oriented Programming Features of Rust" />

<meta name="og:type" content="website" />
<meta property="og:title" content="After reading Rust book chapter 17" />
<meta property="og:site_name" content="After reading Rust book chapter 17" />
<meta property="og:description" content="Object-Oriented Programming Features of Rust" />
<meta property="og:url" content="https://wacilpong.github.io/blog/study/rust/rust-17/" />

<meta name="twitter:card" content="summary" />
<meta name="twitter:title" content="After reading Rust book chapter 17" />
<meta name="twitter:description" content="Object-Oriented Programming Features of Rust" />

<meta property="og:image" content="https://ca.slack-edge.com/T17RWEQDQ-UHVBKS9HA-41689aac3b87-512" />
<meta
  property="twitter:image:src"
  content="https://ca.slack-edge.com/T17RWEQDQ-UHVBKS9HA-41689aac3b87-512"
/>


<script
  async
  src="https://www.googletagmanager.com/gtag/js?id=UA-171393148-1"
></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag() {
    dataLayer.push(arguments);
  }
  gtag("js", new Date());

  gtag("config", "UA-171393148-1");
</script>

        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>After reading Rust book chapter 17</title>
        
            <link rel="icon" href="https://wacilpong.github.io/blog/favicon.ico">
        
        <style>

    html body {
        font-family: 'Raleway', sans-serif;
        background-color: white;
    }

    :root {
        --accent: #469160;
        --border-width:  5px ;
    }

</style>


<link rel="stylesheet" href="https://wacilpong.github.io/blog/css/main.css">


 <link rel="stylesheet" href="https://wacilpong.github.io/blog/css/custom.css"> 


<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Raleway">


 <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/solarized-dark.min.css"> 


<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">


<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN" crossorigin="anonymous">
 

    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
    
    <script>hljs.initHighlightingOnLoad();</script>






<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>


<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>


<script>$(document).on('click', function() { $('.collapse').collapse('hide'); })</script>
 <meta name="generator" content="Hugo 0.73.0" />
        

        

        
            <script type="text/javascript" async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
        

        

    </head>

    <body>
        

        <nav class="navbar navbar-default navbar-fixed-top">
            <div class="container">
                <div class="navbar-header">
                    <a class="navbar-brand visible-xs" href="#">After reading Rust book chapter 17</a>
                    <button class="navbar-toggle" data-target=".navbar-collapse" data-toggle="collapse">
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                </div>
                <div class="collapse navbar-collapse">
                    
                        <ul class="nav navbar-nav">
                            
                                <li><a href="/blog/">Home</a></li>
                            
                                <li><a href="/blog/tags/">Category</a></li>
                            
                                <li><a href="/blog/post/">Posts</a></li>
                            
                                <li><a href="/blog/project/">Projects</a></li>
                            
                                <li><a href="/blog/learned/">What I Learned</a></li>
                            
                        </ul>
                    
                    
                        <ul class="nav navbar-nav navbar-right">
                            
                                <li class="navbar-icon"><a href="https://github.com/wacilpong/"><i class="fa fa-github"></i></a></li>
                            
                                <li class="navbar-icon"><a href="https://www.linkedin.com/in/areum-han-a10645118/"><i class="fa fa-linkedin"></i></a></li>
                            
                        </ul>
                    
                </div>
            </div>
        </nav>


<main>

    <div>
        <h2>After reading Rust book chapter 17</h2>
        <h5></h5>
        
<a href="https://wacilpong.github.io/blog/tags/rust"><kbd class="item-tag">rust</kbd></a>


    </div>

    <div align="start" class="content"><h2 id="객체지향-언어의-특징">객체지향 언어의 특징</h2>
<h3 id="1-1-데이터와-행위를-정의하는-객체">1-1. 데이터와 행위를 정의하는 객체</h3>
<ul>
<li>객체는 데이터와 그 데이터를 운영하는 절차(메서드)를 모아둔 개념이다.</li>
<li>구조체/열거자는 impl 블록을 통해 메서드를 제공하기 때문에 러스트는 객체지향이다.</li>
</ul>
<p><br /></p>
<h3 id="1-2-캡슐화">1-2. 캡슐화</h3>
<ul>
<li>객체의 상세 구현에 접근하지 못하도록 한다.</li>
<li>공개API에 의존하여 객체를 다룰 수 있다.</li>
<li>러스트에서는 <code>pub</code> 키워드를 적용할 수 있으며, 기본적으로 모든 것은 비공개이다.</li>
</ul>
<p><br /></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-rust" data-lang="rust"><span style="color:#66d9ef">pub</span> <span style="color:#66d9ef">struct</span> <span style="color:#a6e22e">AveragedCollection</span> {
	list: Vec<span style="color:#f92672">&lt;</span><span style="color:#66d9ef">i32</span><span style="color:#f92672">&gt;</span>,
	average: <span style="color:#66d9ef">f64</span>,
}

<span style="color:#66d9ef">impl</span> AveragedCollection {
    <span style="color:#66d9ef">pub</span> <span style="color:#66d9ef">fn</span> <span style="color:#a6e22e">add</span>(<span style="color:#f92672">&amp;</span><span style="color:#66d9ef">mut</span> self, value: <span style="color:#66d9ef">i32</span>) {
        self.list.push(value);
        self.update_average();
    }

    <span style="color:#66d9ef">pub</span> <span style="color:#66d9ef">fn</span> <span style="color:#a6e22e">remove</span>(<span style="color:#f92672">&amp;</span><span style="color:#66d9ef">mut</span> self) -&gt; Option<span style="color:#f92672">&lt;</span><span style="color:#66d9ef">i32</span><span style="color:#f92672">&gt;</span> {
        <span style="color:#66d9ef">let</span> result <span style="color:#f92672">=</span> self.list.pop();
        <span style="color:#66d9ef">match</span> result {
            Some(value) <span style="color:#f92672">=&gt;</span> {
                self.update_average();
                Some(value)
            }
            None <span style="color:#f92672">=&gt;</span> None,
        }
    }

    <span style="color:#66d9ef">pub</span> <span style="color:#66d9ef">fn</span> <span style="color:#a6e22e">average</span>(<span style="color:#f92672">&amp;</span>self) -&gt; <span style="color:#66d9ef">f64</span> {
        self.average
    }

    <span style="color:#66d9ef">fn</span> <span style="color:#a6e22e">update_average</span>(<span style="color:#f92672">&amp;</span><span style="color:#66d9ef">mut</span> self) {
        <span style="color:#66d9ef">let</span> total: <span style="color:#66d9ef">i32</span> <span style="color:#f92672">=</span> self.list.iter().sum();
        self.average <span style="color:#f92672">=</span> total <span style="color:#66d9ef">as</span> <span style="color:#66d9ef">f64</span> <span style="color:#f92672">/</span> self.list.len() <span style="color:#66d9ef">as</span> <span style="color:#66d9ef">f64</span>;
    }
}
</code></pre></div><ul>
<li><code>add</code>, <code>remove</code>, <code>average</code> 라는 공개 메서드로 아이템을 조작할 수 있다.</li>
<li><code>list</code>, <code>average</code> 필드는 비공개이므로 외부에서 필드값을 변경할 수 없다.</li>
</ul>
<p><br /></p>
<h3 id="13-타입-시스템으로서의-상속-코드-공유를-위한-상속">1.3. 타입 시스템으로서의 상속, 코드 공유를 위한 상속</h3>
<ul>
<li>객체가 다른 객체의 데이터와 행위를 물려받는 메커니즘이다.</li>
<li>러스트에는 부모 구조체의 필드와 메서드 구현을 물려받는 구조체를 정의하는 <strong>상속</strong>의 개념은 없다.</li>
</ul>
<p><br /></p>
<h4 id="상속을-택하는-이유">상속을 택하는 이유?</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-rust" data-lang="rust">  <span style="color:#66d9ef">pub</span> <span style="color:#66d9ef">trait</span> Summary {
      <span style="color:#66d9ef">fn</span> <span style="color:#a6e22e">summarize</span>(<span style="color:#f92672">&amp;</span>self) -&gt; String {
          String::from(<span style="color:#e6db74">&#34;(lRead more...)&#34;</span>)
      }
  }

  <span style="color:#66d9ef">pub</span> <span style="color:#66d9ef">struct</span> <span style="color:#a6e22e">NewsArticle</span> {
      <span style="color:#66d9ef">pub</span> headline: String,
      <span style="color:#66d9ef">pub</span> location: String,
      <span style="color:#66d9ef">pub</span> author: String,
      <span style="color:#66d9ef">pub</span> content: String,
  }

  <span style="color:#66d9ef">impl</span> Summary <span style="color:#66d9ef">for</span> NewsArticle {}

  <span style="color:#66d9ef">let</span> article <span style="color:#f92672">=</span> NewsArticle {
      headline: String::from(<span style="color:#e6db74">&#34;Penguins win the Stanley Cup Championship!&#34;</span>),
      location: String::from(<span style="color:#e6db74">&#34;Pittsburgh, PA, USA&#34;</span>),
      author: String::from(<span style="color:#e6db74">&#34;Iceburgh&#34;</span>),
      content: String::from(
          <span style="color:#960050;background-color:#1e0010">&#34;</span>The Pittsburgh Penguins once again are the best <span style="color:#960050;background-color:#1e0010">\</span>
           hockey team <span style="color:#66d9ef">in</span> the NHL.<span style="color:#960050;background-color:#1e0010">&#34;</span>,
      ),
  };

  println<span style="color:#f92672">!</span>(<span style="color:#e6db74">&#34;New article available! {}&#34;</span>, article.summarize());
</code></pre></div><ul>
<li><code>Summary</code> 트레이트를 구현하는 타입이라면 <code>summarize</code> 메서드를 활용 가능하다.<br />
<em>부모 클래스에 메서드를 구현하면 상속 받는 자식 클래스에서도 메서드를 사용 가능한 것과 유사</em></li>
<li><code>Summary</code> 트레이트를 구현할 때 <code>summarize</code> 메서드의 기본 구현을 재정의 가능하다.<br />
<em>부모 클래스의 메서드를 자식 클래스에서 override하는 것과 유사</em></li>
</ul>
<p><br /></p>
<ul>
<li>(1) 코드의 재사용: 러스트는 트레이트를 통해 다른 방식으로 구현 가능하다.</li>
<li>(2) 타입 시스템: 러스트는 제네릭과 트레이트 경계를 통해 타입들의 규칙을 정의한다.
<ul>
<li>부모 타입이 필요한 곳에 자식 타입을 전달할 수 있게 하려는 <strong>다형성</strong> 속성</li>
<li>상속에서는 서브클래스를 이용해 다형성을 구현한다.</li>
<li>러스트는 제네릭을 사용하며 트레이트 경계를 이용해 타입들이 반드시 제공해야 할 규칙을 정의한다.</li>
</ul>
</li>
</ul>
<p><br /></p>
<ul>
<li>상속은 최근에 여러 언어에서 프로그래밍 디자인 해법으로서의 가치를 잃었다고 한다.
<ul>
<li>필요 이상의 많은 코드를 공유해야하기 때문이다.</li>
<li>부모 클래스의 메서드는 서브클래스를 위한 것이 아니므로 서브클래스에서 호출하는 것이 논리상 X</li>
<li>이것이 에러를 유발하는 원인이 되기도 한다.</li>
<li>러스트에서는 상속 대신 <strong>트레이트 객체</strong>를 이용하는 방법을 채택하게 되었다.</li>
</ul>
</li>
</ul>
<p><br /></p>
<hr />
<h2 id="다른-타입을-허용하는-트레이트-객체">다른 타입을 허용하는 트레이트 객체</h2>
<h3 id="2-1-트레이트-공통-행위를-정의">2-1. 트레이트: 공통 행위를 정의</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-rust" data-lang="rust"><span style="color:#66d9ef">pub</span> <span style="color:#66d9ef">trait</span> Draw {
    <span style="color:#66d9ef">fn</span> <span style="color:#a6e22e">draw</span>(<span style="color:#f92672">&amp;</span>self);
}

<span style="color:#75715e">// (1) 트레이트만을 활용한 객체
</span><span style="color:#75715e">// : 여러 타입을 저장할 수 있다.
</span><span style="color:#75715e"></span><span style="color:#66d9ef">pub</span> <span style="color:#66d9ef">struct</span> <span style="color:#a6e22e">Screen</span> {
    <span style="color:#66d9ef">pub</span> components: Vec<span style="color:#f92672">&lt;</span>Box<span style="color:#f92672">&lt;</span>dyn Draw<span style="color:#f92672">&gt;&gt;</span>,
}

<span style="color:#66d9ef">impl</span> Screen {
    <span style="color:#66d9ef">pub</span> <span style="color:#66d9ef">fn</span> <span style="color:#a6e22e">run</span>(<span style="color:#f92672">&amp;</span>self) {
        <span style="color:#66d9ef">for</span> component <span style="color:#66d9ef">in</span> self.components.iter() {
            component.draw();
        }
    }
}

<span style="color:#75715e">// (2) 제네릭과 트레이트 경계를 활용한 객체
</span><span style="color:#75715e">// : 같은 종류의 타입에 대한 컬렉션을 지원한다.
</span><span style="color:#75715e">// pub struct Screen&lt;T: Draw&gt; {
</span><span style="color:#75715e">//     pub components: Vec&lt;T&gt;
</span><span style="color:#75715e">// }
</span><span style="color:#75715e"></span>
<span style="color:#75715e">// impl&lt;T&gt; Screen&lt;T&gt;
</span><span style="color:#75715e">//     where T: Draw {
</span><span style="color:#75715e">//     pub fn run(&amp;self) {
</span><span style="color:#75715e">//         for component in self.components.iter() {
</span><span style="color:#75715e">//             component.draw();
</span><span style="color:#75715e">//         }
</span><span style="color:#75715e">//     }
</span><span style="color:#75715e">// }
</span></code></pre></div><ul>
<li>트레이트 객체는 <code>&amp;</code> 참조, <code>Box&lt;T&gt;</code> 스마트 포인터 등의 포인터를 이용해 생성해야 하고, <code>dyn</code> 키워드와 함께 트레이트를 명시해야 한다.</li>
<li>다른 언어에서는 데이터와 행위를 <strong>객체</strong>라는 하나의 개념으로 칭한다.</li>
<li>러스트 구조체/열거자는 필드에 저장된 데이터와 <code>impl</code> 블록에 정의하는 행위가 별개이므로 객체가 아니다.</li>
<li>트레이트 객체는 데이터와 행위가 결합하지만, 객체와 다른 점은 데이터를 추가할 수 없다.<br />
<em>트레이트 객체의 목적: 공통된 행위에 대한 추상화를 제공한다.</em></li>
</ul>
<p><br /></p>
<h3 id="2-2-트레이트-구현">2-2. 트레이트 구현</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-rust" data-lang="rust"><span style="color:#66d9ef">pub</span> <span style="color:#66d9ef">trait</span> Draw {
    <span style="color:#66d9ef">fn</span> <span style="color:#a6e22e">draw</span>(<span style="color:#f92672">&amp;</span>self);
}

<span style="color:#66d9ef">pub</span> <span style="color:#66d9ef">struct</span> <span style="color:#a6e22e">Screen</span> {
    <span style="color:#66d9ef">pub</span> components: Vec<span style="color:#f92672">&lt;</span>Box<span style="color:#f92672">&lt;</span>dyn Draw<span style="color:#f92672">&gt;&gt;</span>
}

<span style="color:#66d9ef">impl</span> Screen {
    <span style="color:#66d9ef">pub</span> <span style="color:#66d9ef">fn</span> <span style="color:#a6e22e">run</span>(<span style="color:#f92672">&amp;</span>self) {
        <span style="color:#66d9ef">for</span> component <span style="color:#66d9ef">in</span> self.components.iter() {
            component.draw();
        }
    }
}


<span style="color:#75715e">// Button이 아닌 다른 구조체일 경우 다른 필드가 정의될 수 있다.
</span><span style="color:#75715e">// 다른 타입이여도 Draw 트레이트를 구현하고 있다.
</span><span style="color:#75715e"></span><span style="color:#66d9ef">pub</span> <span style="color:#66d9ef">struct</span> <span style="color:#a6e22e">Button</span> {
    <span style="color:#66d9ef">pub</span> width: <span style="color:#66d9ef">u32</span>,
    <span style="color:#66d9ef">pub</span> height: <span style="color:#66d9ef">u32</span>,
    <span style="color:#66d9ef">pub</span> label: String,
}

<span style="color:#66d9ef">impl</span> Draw <span style="color:#66d9ef">for</span> Button {
    <span style="color:#66d9ef">fn</span> <span style="color:#a6e22e">draw</span>(<span style="color:#f92672">&amp;</span>self) {
        println<span style="color:#f92672">!</span>(<span style="color:#e6db74">&#34;Draw Button&#34;</span>);
    }
}
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-rust" data-lang="rust"><span style="color:#66d9ef">use</span> gui::Draw;

<span style="color:#66d9ef">struct</span> <span style="color:#a6e22e">SelectBox</span> {
    width: <span style="color:#66d9ef">u32</span>,
    height: <span style="color:#66d9ef">u32</span>,
    options: Vec<span style="color:#f92672">&lt;</span>String<span style="color:#f92672">&gt;</span>,
}

<span style="color:#66d9ef">impl</span> Draw <span style="color:#66d9ef">for</span> SelectBox {
    <span style="color:#66d9ef">fn</span> <span style="color:#a6e22e">draw</span>(<span style="color:#f92672">&amp;</span>self) {
        println<span style="color:#f92672">!</span>(<span style="color:#e6db74">&#34;Draw SelectBox&#34;</span>)
    }
}

<span style="color:#66d9ef">use</span> gui::{Button, Screen};

<span style="color:#66d9ef">fn</span> <span style="color:#a6e22e">main</span>() {
    <span style="color:#66d9ef">let</span> screen <span style="color:#f92672">=</span> Screen {
        components: <span style="color:#a6e22e">vec</span><span style="color:#f92672">!</span>[
            Box::new(SelectBox {
                width: <span style="color:#ae81ff">75</span>,
                height: <span style="color:#ae81ff">10</span>,
                options: <span style="color:#a6e22e">vec</span><span style="color:#f92672">!</span>[
                    String::from(<span style="color:#e6db74">&#34;Yes&#34;</span>),
                    String::from(<span style="color:#e6db74">&#34;Maybe&#34;</span>),
                    String::from(<span style="color:#e6db74">&#34;No&#34;</span>),
                ],
            }),
            Box::new(Button {
                width: <span style="color:#ae81ff">50</span>,
                height: <span style="color:#ae81ff">10</span>,
                label: String::from(<span style="color:#e6db74">&#34;OK&#34;</span>),
            })
        ],
    };


    <span style="color:#75715e">// (Duck typing과 유사)
</span><span style="color:#75715e"></span>    <span style="color:#75715e">// Screen 구조체의 run 메서드: draw 메서드만 호출하면 되기 때문에 각 컴포넌트의 실제 타입은 상관 없다.
</span><span style="color:#75715e"></span>    screen.run();
}
</code></pre></div><ul>
<li>
<p>러스트는 어떤 값이 특정 메서드를 구현하는 지 런타임에 검사할 필요가 없다.</p>
</li>
<li>
<p>필요한 메서드를 구현하지 않았을 때 발생할 에러에 대해도 걱정할 필요가 없다.</p>
</li>
<li>
<p>어떤 값이 트레이트 객체에 필요한 트레이트를 구현하지 않으면 컴파일 단계에서 허용하지 않기 때문이다.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-rust" data-lang="rust"><span style="color:#66d9ef">use</span> gui::Screen;

<span style="color:#66d9ef">fn</span> <span style="color:#a6e22e">main</span>() {
    <span style="color:#66d9ef">let</span> screen <span style="color:#f92672">=</span> Screen {
        <span style="color:#75715e">// String 타입에 Draw 트레이트에 필요한 메서드가 없기 때문에 컴파일 오류 발생!
</span><span style="color:#75715e"></span>        components: <span style="color:#a6e22e">vec</span><span style="color:#f92672">!</span>[Box::new(String::from(<span style="color:#e6db74">&#34;Hi&#34;</span>))],
    };

    screen.run();
}
</code></pre></div></li>
</ul>
<p><br /></p>
<h3 id="2-3-동적-호출을-수행하는-트레이트-객체">2-3. 동적 호출을 수행하는 트레이트 객체</h3>
<ul>
<li><code>정적 호출 (static dispatch)</code>
<ul>
<li>컴파일러가 메서드를 사용하는 코드를 분석해 제네릭 타입 매개변수를 실제 타입으로 대체하는 코드를 생성해 정적 호출을 실행한다.</li>
<li>컴파일러가 컴파일타임에 어떤 메서드를 호출하는지 알고 있다는 의미이다.</li>
</ul>
</li>
<li><code>동적 호출 (dynamic dispatch)</code>
<ul>
<li>컴파일러가 컴파일타임에 어떤 메서드를 호출하는지 판단하지 못하는 경우에 실행한다.</li>
<li>컴파일러가 런타임에 호출할 메서드를 찾아내기 위한 코드를 추가한다.</li>
</ul>
</li>
<li>트레이트 객체는 동적 호출을 사용한다.
<ul>
<li>컴파일러가 트레이트 객체를 사용하는 코드에 사용되는 타입을 모두 알 수 없다.</li>
<li>러스트는 런타임에 트레이트 객체의 포인터를 이용해 어떤 메서드를 호출할 것인지를 알아낸다.<br />
<em>런타임 비용 발생</em></li>
<li>하지만 코드의 유연성이 향상되기 때문에 케이스에 맞게 적절한 사용을 권장한다.</li>
</ul>
</li>
</ul>
<p><br /></p>
<h3 id="2-4-객체-안전성을-요구하는-트레이트-객체">2-4. 객체 안전성을 요구하는 트레이트 객체</h3>
<ul>
<li>러스트는 트레이트를 구현하는 실제 타입을 알 수 없으므로 객체 안전성이 보장되어야 한다.</li>
<li>트레이트 객체는 <strong>객체 안전성</strong>을 가진 트레이트만 사용할 수 있다.</li>
<li>트레이트의 모든 메서드가 다음의 조건을 충족하면 안전하다.
<ul>
<li><strong>(1) 메서드의 반환 타입이 Self가 아니다.</strong></li>
<li><strong>(2) 메서드에 제네릭 타입 매개변수가 없다.</strong></li>
</ul>
</li>
</ul>
<p><br /></p>
<hr />
<h2 id="객체지향-디자인-패턴-구현">객체지향 디자인 패턴 구현</h2>
<h4 id="상태-패턴-state-pattern"><strong>상태 패턴 (state pattern)</strong></h4>
<ul>
<li>
<p>객체지향 디자인 패턴</p>
</li>
<li>
<p>객체가 특정 상태에 따라 행위를 달리하는 상황에서 자신이 직접 상태를 체크하여 상태에 따라 행위를 호출하지 않고, 상태를 객체화 하여 상태가 행동을 할 수 있도록 위임하는 패턴을 말한다.</p>
<p><br /></p>
</li>
</ul>
<h3 id="3-15-blog-post-상태-패턴-구현해보기">3-1~5. Blog, Post 상태 패턴 구현해보기</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-rust" data-lang="rust"><span style="color:#75715e">// lib.rs
</span><span style="color:#75715e"></span><span style="color:#66d9ef">pub</span> <span style="color:#66d9ef">struct</span> <span style="color:#a6e22e">Post</span> {
    state: Option<span style="color:#f92672">&lt;</span>Box<span style="color:#f92672">&lt;</span>dyn State<span style="color:#f92672">&gt;&gt;</span>,
    content: String,
}

<span style="color:#66d9ef">impl</span> Post {
    <span style="color:#66d9ef">pub</span> <span style="color:#66d9ef">fn</span> <span style="color:#a6e22e">new</span>() -&gt; <span style="color:#a6e22e">Post</span> {
        Post {
            state: Some(Box::new(Draft {})),
            content: String::new(),
        }
    }

    <span style="color:#66d9ef">pub</span> <span style="color:#66d9ef">fn</span> <span style="color:#a6e22e">add_text</span>(<span style="color:#f92672">&amp;</span><span style="color:#66d9ef">mut</span> self, text: <span style="color:#66d9ef">&amp;</span><span style="color:#66d9ef">str</span>) {
        self.content.push_str(text);
    }

    <span style="color:#66d9ef">pub</span> <span style="color:#66d9ef">fn</span> <span style="color:#a6e22e">content</span>(<span style="color:#f92672">&amp;</span>self) -&gt; <span style="color:#66d9ef">&amp;</span><span style="color:#66d9ef">str</span> {
        <span style="color:#75715e">// self.state의 소유권은 필요하지 않으므로
</span><span style="color:#75715e"></span>        <span style="color:#75715e">// state의 참조를 얻기 위해 as_ref()를 호출한다.
</span><span style="color:#75715e"></span>        self.state.as_ref().unwrap().content(<span style="color:#f92672">&amp;</span>self)
    }

    <span style="color:#66d9ef">pub</span> <span style="color:#66d9ef">fn</span> <span style="color:#a6e22e">request_review</span>(<span style="color:#f92672">&amp;</span><span style="color:#66d9ef">mut</span> self) {
        <span style="color:#75715e">// 구조체의 필드에 값을 대입하지 않는 것을 허용하지 않기 때문에
</span><span style="color:#75715e"></span>        <span style="color:#75715e">// Some 값일 때에만 그 값의 소유권을 가져온다.
</span><span style="color:#75715e"></span>        <span style="color:#66d9ef">if</span> <span style="color:#66d9ef">let</span> Some(s) <span style="color:#f92672">=</span> self.state.take() {
            self.state <span style="color:#f92672">=</span> Some(s.request_review())
        }
    }

    <span style="color:#66d9ef">pub</span> <span style="color:#66d9ef">fn</span> <span style="color:#a6e22e">approve</span>(<span style="color:#f92672">&amp;</span><span style="color:#66d9ef">mut</span> self) {
        <span style="color:#66d9ef">if</span> <span style="color:#66d9ef">let</span> Some(s) <span style="color:#f92672">=</span> self.state.take() {
            self.state <span style="color:#f92672">=</span> Some(s.approve())
        }
    }
}

<span style="color:#66d9ef">trait</span> State {
    <span style="color:#75715e">// self를 Box&lt;Self&gt; 타입으로 둔 이유
</span><span style="color:#75715e"></span>    <span style="color:#75715e">// : Box&lt;Self&gt; 타입의 소유권을 가져와 상태를 새로운 상태로 변경하기 위해
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">fn</span> <span style="color:#a6e22e">request_review</span>(self: Box<span style="color:#f92672">&lt;</span>Self<span style="color:#f92672">&gt;</span>) -&gt; Box<span style="color:#f92672">&lt;</span>dyn State<span style="color:#f92672">&gt;</span>;
    <span style="color:#66d9ef">fn</span> <span style="color:#a6e22e">approve</span>(self: Box<span style="color:#f92672">&lt;</span>Self<span style="color:#f92672">&gt;</span>) -&gt; Box<span style="color:#f92672">&lt;</span>dyn State<span style="color:#f92672">&gt;</span>;
    <span style="color:#66d9ef">fn</span> <span style="color:#a6e22e">content</span><span style="color:#f92672">&lt;</span><span style="color:#a6e22e">&#39;a</span><span style="color:#f92672">&gt;</span>(<span style="color:#f92672">&amp;</span>self, post: <span style="color:#66d9ef">&amp;</span><span style="color:#a6e22e">&#39;a</span> Post) -&gt; <span style="color:#66d9ef">&amp;</span><span style="color:#a6e22e">&#39;a</span> <span style="color:#66d9ef">str</span> {
        <span style="color:#e6db74">&#34;&#34;</span>
    }
}

<span style="color:#66d9ef">struct</span> <span style="color:#a6e22e">Draft</span> {}

<span style="color:#66d9ef">impl</span> State <span style="color:#66d9ef">for</span> Draft {
    <span style="color:#66d9ef">fn</span> <span style="color:#a6e22e">request_review</span>(self: Box<span style="color:#f92672">&lt;</span>Self<span style="color:#f92672">&gt;</span>) -&gt; Box<span style="color:#f92672">&lt;</span>dyn State<span style="color:#f92672">&gt;</span> {
        <span style="color:#75715e">// 리뷰를 기다리는 상태로 변경된다.
</span><span style="color:#75715e"></span>        Box::new(PendingReview {})
    }

    <span style="color:#66d9ef">fn</span> <span style="color:#a6e22e">approve</span>(self: Box<span style="color:#f92672">&lt;</span>Self<span style="color:#f92672">&gt;</span>) -&gt; Box<span style="color:#f92672">&lt;</span>dyn State<span style="color:#f92672">&gt;</span> {
        self
    }
}

<span style="color:#66d9ef">struct</span> <span style="color:#a6e22e">PendingReview</span> {}

<span style="color:#66d9ef">impl</span> State <span style="color:#66d9ef">for</span> PendingReview {
    <span style="color:#66d9ef">fn</span> <span style="color:#a6e22e">request_review</span>(self: Box<span style="color:#f92672">&lt;</span>Self<span style="color:#f92672">&gt;</span>) -&gt; Box<span style="color:#f92672">&lt;</span>dyn State<span style="color:#f92672">&gt;</span> {
        <span style="color:#75715e">// 이미 리뷰를 기다리는 상태이기 때문에 self를 반환한다.
</span><span style="color:#75715e"></span>        <span style="color:#75715e">// Post 구조체의 request_review 메서드는 현재 상태값이 어떻든 같은 코드를 동작하고,
</span><span style="color:#75715e"></span>        <span style="color:#75715e">// 상태 변환에 대한 것은 각 상태에 위임한다.
</span><span style="color:#75715e"></span>        self
    }

      <span style="color:#66d9ef">fn</span> <span style="color:#a6e22e">approve</span>(self: Box<span style="color:#f92672">&lt;</span>Self<span style="color:#f92672">&gt;</span>) -&gt; Box<span style="color:#f92672">&lt;</span>dyn State<span style="color:#f92672">&gt;</span> {
        Box::new(Published {})
    }
}

<span style="color:#66d9ef">struct</span> <span style="color:#a6e22e">Published</span> {}

<span style="color:#66d9ef">impl</span> State <span style="color:#66d9ef">for</span> Published {
    <span style="color:#66d9ef">fn</span> <span style="color:#a6e22e">request_review</span>(self: Box<span style="color:#f92672">&lt;</span>Self<span style="color:#f92672">&gt;</span>) -&gt; Box<span style="color:#f92672">&lt;</span>dyn State<span style="color:#f92672">&gt;</span> {
        self
    }

    <span style="color:#66d9ef">fn</span> <span style="color:#a6e22e">approve</span>(self: Box<span style="color:#f92672">&lt;</span>Self<span style="color:#f92672">&gt;</span>) -&gt; Box<span style="color:#f92672">&lt;</span>dyn State<span style="color:#f92672">&gt;</span> {
        self
    }

    <span style="color:#75715e">// 왜 수명 어노테이션이 필요할까?
</span><span style="color:#75715e"></span>    <span style="color:#75715e">// post의 참조를 인수로 전달받고, post의 일부를 참조로 반환해야 하므로
</span><span style="color:#75715e"></span>    <span style="color:#75715e">// 반환하는 참조의 수명은 인수로 전달받은 수명과 관련이 있다.
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">fn</span> <span style="color:#a6e22e">content</span><span style="color:#f92672">&lt;</span><span style="color:#a6e22e">&#39;a</span><span style="color:#f92672">&gt;</span>(<span style="color:#f92672">&amp;</span>self, post: <span style="color:#66d9ef">&amp;</span><span style="color:#a6e22e">&#39;a</span> Post) -&gt; <span style="color:#66d9ef">&amp;</span><span style="color:#a6e22e">&#39;a</span> <span style="color:#66d9ef">str</span> {
        <span style="color:#f92672">&amp;</span>post.content
    }
}
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-rust" data-lang="rust"><span style="color:#75715e">// main.rs
</span><span style="color:#75715e"></span><span style="color:#66d9ef">use</span> blog::Post;

<span style="color:#66d9ef">fn</span> <span style="color:#a6e22e">main</span>() {
    <span style="color:#66d9ef">let</span> <span style="color:#66d9ef">mut</span> post <span style="color:#f92672">=</span> Post::new();

    post.add_text(<span style="color:#e6db74">&#34;나는 오늘 점심으로 샐러드를 먹었다.&#34;</span>);
    assert_eq<span style="color:#f92672">!</span>(<span style="color:#e6db74">&#34;&#34;</span>, post.content());

    post.request_review();
    assert_eq<span style="color:#f92672">!</span>(<span style="color:#e6db74">&#34;&#34;</span>, post.content());

    post.approve();
    assert_eq<span style="color:#f92672">!</span>(<span style="color:#e6db74">&#34;나는 오늘 점심으로 샐러드를 먹었다.&#34;</span>, post.content());
}
</code></pre></div><p><br /></p>
<h3 id="3-6-상태-패턴의-트레이드-오프">3-6. 상태 패턴의 트레이드 오프</h3>
<ul>
<li>상태 패턴의 장/단점
<ul>
<li>(장) 상태 패턴을 사용하면 상태를 확인하고 개별 동작을 구현할 필요가 없다.</li>
<li>(장) <strong>새로운 구현을 추가해 확장하기가 수월하다는 장점이 있다.</strong></li>
<li>(단) 상태 객체가 상태 간의 전환을 구현하기 때문에 일부 상태가 다른 상태와 연결될 수 있다.</li>
<li>(단) 로직이 중복된다.</li>
</ul>
</li>
</ul>
<p><br /></p>
<ul>
<li>
<p>상태와 행위를 타입으로 정의하기</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-rust" data-lang="rust"><span style="color:#75715e">// lib.rs
</span><span style="color:#75715e"></span><span style="color:#66d9ef">pub</span> <span style="color:#66d9ef">struct</span> <span style="color:#a6e22e">Post</span> {
    content: String,
}

<span style="color:#66d9ef">pub</span> <span style="color:#66d9ef">struct</span> <span style="color:#a6e22e">DraftPost</span> {
    content: String,
}

<span style="color:#66d9ef">impl</span> Post {
    <span style="color:#66d9ef">pub</span> <span style="color:#66d9ef">fn</span> <span style="color:#a6e22e">new</span>() -&gt; <span style="color:#a6e22e">DraftPost</span> {
        DraftPost {
            content: String::new(),
        }
    }

    <span style="color:#66d9ef">pub</span> <span style="color:#66d9ef">fn</span> <span style="color:#a6e22e">content</span>(<span style="color:#f92672">&amp;</span>self) -&gt; <span style="color:#66d9ef">&amp;</span><span style="color:#66d9ef">str</span> {
        <span style="color:#f92672">&amp;</span>self.content
    }
}

<span style="color:#66d9ef">impl</span> DraftPost {
    <span style="color:#66d9ef">pub</span> <span style="color:#66d9ef">fn</span> <span style="color:#a6e22e">add_text</span>(<span style="color:#f92672">&amp;</span><span style="color:#66d9ef">mut</span> self, text: <span style="color:#66d9ef">&amp;</span><span style="color:#66d9ef">str</span>) {
        self.content.push_str(text);
    }
}
</code></pre></div><ul>
<li>DraftPost 구조체에서는 content 메서드를 제공하지 않는다.</li>
<li>따라서 초고 상태의 포스트는 content를 출력하지 못한다는 사실을 보장할 수 있다.<br />
<em>위반 시 컴파일 에러 발생</em></li>
</ul>
</li>
</ul>
<p><br /></p>
<ul>
<li>
<p>다른 타입으로 전환을 이용해 상태 전환 구현하기</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-rust" data-lang="rust"><span style="color:#66d9ef">pub</span> <span style="color:#66d9ef">struct</span> <span style="color:#a6e22e">Post</span> {
    content: String,
}

<span style="color:#66d9ef">pub</span> <span style="color:#66d9ef">struct</span> <span style="color:#a6e22e">DraftPost</span> {
    content: String,
}

<span style="color:#66d9ef">impl</span> Post {
    <span style="color:#66d9ef">pub</span> <span style="color:#66d9ef">fn</span> <span style="color:#a6e22e">new</span>() -&gt; <span style="color:#a6e22e">DraftPost</span> {
        DraftPost {
            content: String::new(),
        }
    }

    <span style="color:#66d9ef">pub</span> <span style="color:#66d9ef">fn</span> <span style="color:#a6e22e">content</span>(<span style="color:#f92672">&amp;</span>self) -&gt; <span style="color:#66d9ef">&amp;</span><span style="color:#66d9ef">str</span> {
        <span style="color:#f92672">&amp;</span>self.content
    }
}

<span style="color:#66d9ef">impl</span> DraftPost {
    <span style="color:#66d9ef">pub</span> <span style="color:#66d9ef">fn</span> <span style="color:#a6e22e">add_text</span>(<span style="color:#f92672">&amp;</span><span style="color:#66d9ef">mut</span> self, text: <span style="color:#66d9ef">&amp;</span><span style="color:#66d9ef">str</span>) {
        self.content.push_str(text);
    }

    <span style="color:#66d9ef">pub</span> <span style="color:#66d9ef">fn</span> <span style="color:#a6e22e">request_review</span>(self) -&gt; <span style="color:#a6e22e">PendingReviewPost</span> {
        PendingReviewPost {
            content: <span style="color:#a6e22e">self</span>.content,
        }
    }
}

<span style="color:#66d9ef">pub</span> <span style="color:#66d9ef">struct</span> <span style="color:#a6e22e">PendingReviewPost</span> {
    content: String,
}

<span style="color:#66d9ef">impl</span> PendingReviewPost {
    <span style="color:#66d9ef">pub</span> <span style="color:#66d9ef">fn</span> <span style="color:#a6e22e">approve</span>(self) -&gt; <span style="color:#a6e22e">Post</span> {
        Post {
            content: <span style="color:#a6e22e">self</span>.content,
        }
    }
      <span style="color:#75715e">// content 메서드가 없기 때문에 DraftPost 구조체와 마찬가지로
</span><span style="color:#75715e"></span>      <span style="color:#75715e">// content를 출력할 수 없다.
</span><span style="color:#75715e"></span>      <span style="color:#75715e">// approve 메서드를 통해 Post 구조체로 전환하여 content를 출력하는 방법 뿐이다.
</span><span style="color:#75715e"></span>}
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-rust" data-lang="rust"><span style="color:#75715e">// main.rs
</span><span style="color:#75715e"></span><span style="color:#66d9ef">use</span> blog::Post;

<span style="color:#66d9ef">fn</span> <span style="color:#a6e22e">main</span>() {
  <span style="color:#75715e">// DraftPost
</span><span style="color:#75715e"></span>  <span style="color:#66d9ef">let</span> <span style="color:#66d9ef">mut</span> post <span style="color:#f92672">=</span> Post::new();

  post.add_text(<span style="color:#e6db74">&#34;I ate a salad for lunch today&#34;</span>);

  <span style="color:#75715e">// DraftPost -&gt; PendingReviewPost
</span><span style="color:#75715e"></span>  <span style="color:#66d9ef">let</span> post <span style="color:#f92672">=</span> post.request_review();

  <span style="color:#75715e">// PendingReviewPost -&gt; Post
</span><span style="color:#75715e"></span>  <span style="color:#66d9ef">let</span> post <span style="color:#f92672">=</span> post.approve();

  <span style="color:#75715e">// content에 접근 불가한 구조체인 경우 컴파일 에러가 발생하기 때문에
</span><span style="color:#75715e"></span>  <span style="color:#75715e">// 중간 중간 assert_eq를 통해 검사할 필요가 없어졌다.
</span><span style="color:#75715e"></span>  assert_eq<span style="color:#f92672">!</span>(<span style="color:#e6db74">&#34;I ate a salad for lunch today&#34;</span>, post.content());
}
</code></pre></div><ul>
<li>섀도우 인스턴스를 사용하여 post를 다른 타입으로 계속 전환하게 된다.<br />
<em>더 이상 객체지향 상태 패턴을 따르지 않게 된다.</em></li>
<li>해당 패턴의 장점
<ul>
<li>유효하지 않은 상태로의 전환이 불가능하다.</li>
<li>컴파일 타임에 에러가 발생하여 버그를 사전 방지할 수 있다.</li>
</ul>
</li>
</ul>
</li>
</ul>
</div>

</main>

        <footer>
            <p class="copyright text-muted">© All rights reserved. Powered by <a href="https://gohugo.io">Hugo</a> and <a href="https://github.com/calintat/minimal">Minimal</a>.</p>
        </footer>

        

        
    </body>

</html>

