<!DOCTYPE html>
<html lang="kr-ko">
    <head>
        <meta name="description" content="" />

<meta name="og:type" content="website" />
<meta property="og:title" content="refactoring 1: let&#39;s start" />
<meta property="og:site_name" content="refactoring 1: let&#39;s start" />
<meta property="og:description" content="" />
<meta property="og:url" content="https://wacilpong.github.io/blog/study/refactoring/1/" />

<meta name="twitter:card" content="summary" />
<meta name="twitter:title" content="refactoring 1: let&#39;s start" />
<meta name="twitter:description" content="" />

<meta property="og:image" content="https://ca.slack-edge.com/T17RWEQDQ-UHVBKS9HA-41689aac3b87-512" />
<meta
  property="twitter:image:src"
  content="https://ca.slack-edge.com/T17RWEQDQ-UHVBKS9HA-41689aac3b87-512"
/>


<script
  async
  src="https://www.googletagmanager.com/gtag/js?id=UA-171393148-1"
></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag() {
    dataLayer.push(arguments);
  }
  gtag("js", new Date());

  gtag("config", "UA-171393148-1");
</script>

        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>refactoring 1: let&#39;s start</title>
        
            <link rel="icon" href="https://wacilpong.github.io/blog/favicon.ico">
        
        <style>

    html body {
        font-family: 'Raleway', sans-serif;
        background-color: white;
    }

    :root {
        --accent: #469160;
        --border-width:  5px ;
    }

</style>


<link rel="stylesheet" href="https://wacilpong.github.io/blog/css/main.css">


 <link rel="stylesheet" href="https://wacilpong.github.io/blog/css/custom.css"> 


<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Raleway">


 <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/solarized-dark.min.css"> 


<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">


<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN" crossorigin="anonymous">
 

    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
    
    <script>hljs.initHighlightingOnLoad();</script>






<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>


<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>


<script>$(document).on('click', function() { $('.collapse').collapse('hide'); })</script>
 <meta name="generator" content="Hugo 0.73.0" />
        

        

        
            <script type="text/javascript" async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
        

        

    </head>

    <body>
        

        <nav class="navbar navbar-default navbar-fixed-top">
            <div class="container">
                <div class="navbar-header">
                    <a class="navbar-brand visible-xs" href="#">refactoring 1: let&#39;s start</a>
                    <button class="navbar-toggle" data-target=".navbar-collapse" data-toggle="collapse">
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                </div>
                <div class="collapse navbar-collapse">
                    
                        <ul class="nav navbar-nav">
                            
                                <li><a href="/blog/">Home</a></li>
                            
                                <li><a href="/blog/tags/">Category</a></li>
                            
                                <li><a href="/blog/post/">Posts</a></li>
                            
                                <li><a href="/blog/study/">Study</a></li>
                            
                                <li><a href="/blog/learned/">What I Learned</a></li>
                            
                        </ul>
                    
                    
                        <ul class="nav navbar-nav navbar-right">
                            
                                <li class="navbar-icon"><a href="https://github.com/wacilpong/"><i class="fa fa-github"></i></a></li>
                            
                                <li class="navbar-icon"><a href="https://www.linkedin.com/in/areum-han-a10645118/"><i class="fa fa-linkedin"></i></a></li>
                            
                        </ul>
                    
                </div>
            </div>
        </nav>


<main>

    <div>
        <h2>refactoring 1: let&#39;s start</h2>
        <h5>예제를 통한 리팩터링 맛보기</h5>
        

    </div>

    <div align="start" class="content"><h2 id="함수-추출하기">함수 추출하기</h2>
<ul>
<li>프로그램이 새로운 기능을 추가하기에 편한 구조가 아니라면, 먼저 기능을 추가하기 쉬운 형태로 리팩터링하고 나서 원하는 기능을 추가하자.</li>
<li>한번에 너무 많이 수정하려다 실수를 저지르면 디버깅하기 어려워 결과적으로 작업 시간이 늘어난다.</li>
<li>따라서 리팩터링은 프로그램 수정을 작은 단게로 나눠 진행해야 한다.</li>
<li>코드 조각을 함수로 추출할 때 스코프를 벗어나는 변수가 있는지 확인해야 한다.</li>
<li>저자는 함수의 반환 값에는 항상 <code>result</code>라는 이름을 쓴다고 한다.</li>
</ul>
<p><br /></p>
<h2 id="임시-변수를-질의-함수로-바꾸기-변수-인라인하기">임시 변수를 질의 함수로 바꾸기, 변수 인라인하기</h2>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">playFor</span>(<span style="color:#a6e22e">aPerformance</span>) {
  <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">plays</span>[<span style="color:#a6e22e">aPerformance</span>.<span style="color:#a6e22e">playID</span>];
}

<span style="color:#66d9ef">function</span> <span style="color:#a6e22e">statement</span>(<span style="color:#a6e22e">invoice</span>, <span style="color:#a6e22e">plays</span>) {
  ...
  <span style="color:#66d9ef">for</span>(<span style="color:#66d9ef">let</span> <span style="color:#a6e22e">perf</span> <span style="color:#66d9ef">of</span> <span style="color:#a6e22e">invoice</span>.<span style="color:#a6e22e">performance</span>) {
    <span style="color:#75715e">// AS-IS: const play = playFor(perf);
</span><span style="color:#75715e"></span>    <span style="color:#75715e">// TO-DO: 불필요한 변수를 제거하고 아래처럼 사용
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">if</span> (<span style="color:#e6db74">&#39;comedy&#39;</span> <span style="color:#f92672">===</span> <span style="color:#a6e22e">playFor</span>(<span style="color:#a6e22e">perf</span>).<span style="color:#a6e22e">type</span>) {...}
  }
}

</code></pre></div><ul>
<li>지역 변수를 제거해서 얻는 가장 큰 장점은 추출 작업이 훨씬 쉬워진다는 것이다.</li>
<li>스코프를 신경 써야 할 대상이 줄어들기 때문이다.</li>
</ul>
<p><br /></p>
<h2 id="반복문-쪼개기">반복문 쪼개기</h2>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">statement</span>(<span style="color:#a6e22e">invoice</span>, <span style="color:#a6e22e">plays</span>) {
  <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">totalAmount</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
  <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">volumeCredits</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
  <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">result</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">`청구 내역 (고객명: </span><span style="color:#e6db74">${</span><span style="color:#a6e22e">invoice</span>.<span style="color:#a6e22e">customer</span><span style="color:#e6db74">}</span><span style="color:#e6db74">`</span>;

  <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">let</span> <span style="color:#a6e22e">perf</span> <span style="color:#66d9ef">of</span> <span style="color:#a6e22e">invoice</span>.<span style="color:#a6e22e">performances</span>) {
    <span style="color:#a6e22e">result</span> <span style="color:#f92672">+=</span> <span style="color:#f92672">~</span>;
    <span style="color:#a6e22e">totalAmount</span> <span style="color:#f92672">+=</span> <span style="color:#f92672">~</span>;
  }

  <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">let</span> <span style="color:#a6e22e">perf</span> <span style="color:#66d9ef">of</span> <span style="color:#a6e22e">invoice</span>.<span style="color:#a6e22e">performances</span>) {
    <span style="color:#a6e22e">volumeCredits</span> <span style="color:#f92672">+=</span> <span style="color:#a6e22e">volumeCreditsFor</span>(<span style="color:#a6e22e">perf</span>);
  }

  ...
}
</code></pre></div><ul>
<li>반복문을 쪼개서 성능이 느려지지 않을까 걱정할 수 있다. <em>헉 어떻게 알았지!</em></li>
<li>똑똑한 컴파일러들이 최신 캐싱 기법 등으로 무장하고 있어서 전혀 성능 차이를 체감할 수 없다.</li>
<li>리팩터링 과정에서 성능이 크게 떨어졌다면 리팩터링 후에 시간을 내어 개선하는 게 낫다.</li>
<li><strong>즉, 리팩터링으로 인한 성능 문제는 특별한 경우가 아니면 일단 무시하자.</strong><br />
<em><a href="https://www.developerway.com/posts/how-to-use-memo-use-callback">리액트 useMemo, useCallback과 같은 기법에 대해서도 정확히 메모이제이션이 필요한지 아는 경우가 아니면 쓰지 않는 게 낫다는 글들</a>이 있는데 그 글들의 요지도 성능 개선을 먼저 생각하지 말고 다른 버그들이 나지 않도록 로직적으로 더 개선하라는 것</em></li>
</ul>
<p><br /></p>
<h2 id="반복문을-파이프라인으로-바꾸기">반복문을 파이프라인으로 바꾸기</h2>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">totalAmount</span>(<span style="color:#a6e22e">data</span>) {
  <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">data</span>.<span style="color:#a6e22e">performances</span>.<span style="color:#a6e22e">reduce</span>((<span style="color:#a6e22e">total</span>, <span style="color:#a6e22e">p</span>) =&gt; <span style="color:#a6e22e">total</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">p</span>.<span style="color:#a6e22e">amount</span>, <span style="color:#ae81ff">0</span>);
}

<span style="color:#66d9ef">function</span> <span style="color:#a6e22e">totalVolumeCredits</span>(<span style="color:#a6e22e">data</span>) {
  <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">data</span>.<span style="color:#a6e22e">performances</span>.<span style="color:#a6e22e">reduce</span>((<span style="color:#a6e22e">total</span>, <span style="color:#a6e22e">p</span>) =&gt; <span style="color:#a6e22e">total</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">p</span>.<span style="color:#a6e22e">volumeCredits</span>, <span style="color:#ae81ff">0</span>);
}
</code></pre></div><p><br /></p>
<h2 id="조건부-로직을-다형성으로-바꾸기">조건부 로직을 다형성으로 바꾸기</h2>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">createPerformanceCaculator</span>(<span style="color:#a6e22e">aPerforamnce</span>, <span style="color:#a6e22e">aPlay</span>) {
  <span style="color:#66d9ef">switch</span> (<span style="color:#a6e22e">aPlay</span>.<span style="color:#a6e22e">type</span>) {
    <span style="color:#66d9ef">case</span> <span style="color:#e6db74">&#39;tragedy&#39;</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">TragedyCaculator</span>(<span style="color:#a6e22e">aPerforamnce</span>, <span style="color:#a6e22e">aPlay</span>);
    <span style="color:#66d9ef">case</span> <span style="color:#e6db74">&#39;comedy&#39;</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">ComedyCaculator</span>(<span style="color:#a6e22e">aPerforamnce</span>, <span style="color:#a6e22e">aPlay</span>);
    <span style="color:#66d9ef">default</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">throw</span> <span style="color:#66d9ef">new</span> Error(<span style="color:#e6db74">`알 수 없는 장르: </span><span style="color:#e6db74">${</span><span style="color:#a6e22e">aPlay</span>.<span style="color:#a6e22e">type</span><span style="color:#e6db74">}</span><span style="color:#e6db74">`</span>);
  }
}

<span style="color:#75715e">// ...(중략)...
</span><span style="color:#75715e"></span>
<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">PerformanceCaculator</span> {
  <span style="color:#a6e22e">constructor</span>(<span style="color:#a6e22e">aPerformance</span>, <span style="color:#a6e22e">aPlay</span>) {
    <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">performance</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">aPerformance</span>;
    <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">play</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">aPlay</span>;
  }

  <span style="color:#a6e22e">get</span> <span style="color:#a6e22e">amount</span>() {
    <span style="color:#66d9ef">throw</span> <span style="color:#66d9ef">new</span> Error(<span style="color:#e6db74">&#39;서브클래스에서 처리하도록 설계되었습니다.&#39;</span>);
  }

  <span style="color:#a6e22e">get</span> <span style="color:#a6e22e">volumeCredits</span>() {
    <span style="color:#66d9ef">return</span> Math.<span style="color:#a6e22e">max</span>(<span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">performance</span>.<span style="color:#a6e22e">audience</span> <span style="color:#f92672">-</span> <span style="color:#ae81ff">30</span>, <span style="color:#ae81ff">0</span>);
  }
}

<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">TragedyCaculator</span> <span style="color:#66d9ef">extends</span> <span style="color:#a6e22e">PerformanceCaculator</span> {...}
<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">ComedyCaculator</span> <span style="color:#66d9ef">extends</span> <span style="color:#a6e22e">PerformanceCaculator</span> {...}
</code></pre></div><ul>
<li>이제 새로운 장르를 추가하려면 해당 장르의 서브클래스를 만들어 생성함수인 <code>createPerformanceCaculator()</code>에 추가하면 된다.</li>
<li>amount와 volumeCredits 계산하는 조건부 로직을 생성함수 쪽으로 옮겼는데, 같은 타입의 다형성을 기반으로 실행되는 함수가 많을수록 이렇게 구성하는 편이 유리하다.</li>
</ul>
<p><br /></p>
<h2 id="마무리">마무리</h2>
<ul>
<li>리팩터링은 대부분 코드가 하는 일을 파악하는 데서 시작한다.</li>
<li><strong>좋은 코드를 가늠하는 확실한 방법은 <code>얼마나 수정하기 쉬운가</code>다.</strong></li>
<li>단계를 잘게 나눠야 더 빠르게 처리할 수 있고, 이러한 작은 단계가 모여 상당히 큰 변화를 이룰 수 있다는 사실을 꺠닫는 것이 리팩터링을 효과적으로 하는 핵심이다.</li>
</ul>
</div>

</main>

        <footer>
            <p class="copyright text-muted">© All rights reserved. Powered by <a href="https://gohugo.io">Hugo</a> and <a href="https://github.com/calintat/minimal">Minimal</a>.</p>
        </footer>

        

        
    </body>

</html>

